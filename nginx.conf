

                          Runtime Edition

        PM2 is a Production Process Manager for Node.js applications
                     with a built-in Load Balancer.

                Start and Daemonize any application:
                $ pm2 start app.js

                Load Balance 4 instances of api.js:
                $ pm2 start api.js -i 4

                Monitor in production:
                $ pm2 monitor

                Make pm2 auto-boot at server restart:
                $ pm2 startup

                To go further checkout:
                http://pm2.io/


                        -------------

[PM2] Spawning PM2 daemon with pm2_home=/root/.pm2
[PM2] PM2 Successfully daemonized
[PM2] Starting /prod-project/json-server/index.js in fork_mode (1 instance)
[PM2] Done.
┌─────┬──────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id  │ name     │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├─────┼──────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0   │ index    │ default     │ 1.0.0   │ fork    │ 13637    │ 0s     │ 0    │ online    │ 0%       │ 25.8mb   │ root     │ disabled │
└─────┴──────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@226180:/prod-project# pm2 start json-server/index.js
[PM2] Applying action restartProcessId on app [index](ids: [ 0 ])
[PM2] [index](0) ✓
[PM2] Process successfully started
┌─────┬──────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id  │ name     │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├─────┼──────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0   │ index    │ default     │ 1.0.0   │ fork    │ 13934    │ 0s     │ 16   │ online    │ 0%       │ 18.3mb   │ root     │ disabled │
└─────┴──────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@226180:/prod-project# clear

root@226180:/prod-project# cnapd --version
cnapd: command not found
root@226180:/prod-project# snap --version

Command 'snap' not found, but can be installed with:

apt install snapd

root@226180:/prod-project# cd ..
root@226180:/# ls
bin   dev  home        initrd.img.old  lib64       media  opt   prod-project  run   snap  swapfile  tmp  var      vmlinuz.old
boot  etc  initrd.img  lib             lost+found  mnt    proc  root          sbin  srv   sys       usr  vmlinuz
root@226180:/# cnap --version

Command 'cnap' not found, did you mean:

  command 'ncap' from deb nco
  command 'snap' from deb snapd
  command 'czap' from deb dvb-apps
  command 'cap' from deb capistrano

Try: apt install <deb name>

root@226180:/# snap --version

Command 'snap' not found, but can be installed with:

apt install snapd

root@226180:/# snapd --version

Command 'snapd' not found, did you mean:

  command 'snmpd' from deb snmpd
  command 'snap' from deb snapd
  command 'slapd' from deb slapd

Try: apt install <deb name>

root@226180:/# apt install snapd
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages were automatically installed and are no longer required:
  linux-headers-4.15.0-142 linux-headers-4.15.0-142-generic linux-image-4.15.0-142-generic linux-modules-4.15.0-142-generic
  linux-modules-extra-4.15.0-142-generic
Use 'apt autoremove' to remove them.
The following additional packages will be installed:
  apparmor dbus-user-session
Suggested packages:
  apparmor-profiles-extra apparmor-utils zenity | kdialog
The following NEW packages will be installed:
  apparmor dbus-user-session snapd
0 upgraded, 3 newly installed, 0 to remove and 0 not upgraded.
Need to get 38.1 MB of archives.
After this operation, 172 MB of additional disk space will be used.
Do you want to continue? [Y/n] y
Get:1 http://mirror.fornex.org/ubuntu bionic-updates/main amd64 apparmor amd64 2.12-4ubuntu5.1 [487 kB]
Get:2 http://mirror.fornex.org/ubuntu bionic-updates/main amd64 dbus-user-session amd64 1.12.2-1ubuntu1.4 [9388 B]
Get:3 http://mirror.fornex.org/ubuntu bionic-updates/main amd64 snapd amd64 2.57.5+18.04ubuntu0.1 [37.6 MB]
Fetched 38.1 MB in 3s (11.3 MB/s)
Preconfiguring packages ...
Selecting previously unselected package apparmor.
(Reading database ... 164832 files and directories currently installed.)
Preparing to unpack .../apparmor_2.12-4ubuntu5.1_amd64.deb ...
Unpacking apparmor (2.12-4ubuntu5.1) ...
Selecting previously unselected package dbus-user-session.
Preparing to unpack .../dbus-user-session_1.12.2-1ubuntu1.4_amd64.deb ...
Unpacking dbus-user-session (1.12.2-1ubuntu1.4) ...
Selecting previously unselected package snapd.
Preparing to unpack .../snapd_2.57.5+18.04ubuntu0.1_amd64.deb ...
Unpacking snapd (2.57.5+18.04ubuntu0.1) ...
Setting up apparmor (2.12-4ubuntu5.1) ...
Setting up dbus-user-session (1.12.2-1ubuntu1.4) ...
Setting up snapd (2.57.5+18.04ubuntu0.1) ...
Installing new version of config file /etc/apparmor.d/usr.lib.snapd.snap-confine.real ...
Created symlink /etc/systemd/system/multi-user.target.wants/snapd.aa-prompt-listener.service → /lib/systemd/system/snapd.aa-prompt-listener.service.
snapd.failure.service is a disabled or a static unit not running, not starting it.
snapd.snap-repair.service is a disabled or a static unit not running, not starting it.
Processing triggers for man-db (2.8.3-2ubuntu0.1) ...
Processing triggers for dbus (1.12.2-1ubuntu1.4) ...
Processing triggers for mime-support (3.60ubuntu1) ...
Processing triggers for ureadahead (0.100.0-21) ...
Processing triggers for systemd (237-3ubuntu10.56) ...
root@226180:/# snap --version
snap    2.57.5+18.04ubuntu0.1
snapd   2.57.5+18.04ubuntu0.1
series  16
ubuntu  18.04
kernel  4.15.0-202-generic
root@226180:/# snap install core; snap refresh core
2023-01-25T14:36:33+01:00 INFO Waiting for automatic snapd restart...
core 16-2.58 from Canonical✓ installed
snap "core" has no updates available
root@226180:/# apt-get remove certbot
Reading package lists... Done
Building dependency tree
Reading state information... Done
Package 'certbot' is not installed, so not removed
The following packages were automatically installed and are no longer required:
  linux-headers-4.15.0-142 linux-headers-4.15.0-142-generic linux-image-4.15.0-142-generic linux-modules-4.15.0-142-generic
  linux-modules-extra-4.15.0-142-generic
Use 'apt autoremove' to remove them.
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
root@226180:/# snap install --classic certbot
certbot 1.32.2 from Certbot Project (certbot-eff✓) installed
root@226180:/# ls
bin   dev  home        initrd.img.old  lib64       media  opt   prod-project  run   snap  swapfile  tmp  var      vmlinuz.old
boot  etc  initrd.img  lib             lost+found  mnt    proc  root          sbin  srv   sys       usr  vmlinuz
root@226180:/# cd usr
root@226180:/usr# ls
bin  games  include  lib  local  sbin  share  src
root@226180:/usr# cd ..
root@226180:/# ls
bin   dev  home        initrd.img.old  lib64       media  opt   prod-project  run   snap  swapfile  tmp  var      vmlinuz.old
boot  etc  initrd.img  lib             lost+found  mnt    proc  root          sbin  srv   sys       usr  vmlinuz
root@226180:/# ln -s /snap/bin/certbot /usr/bin/certbot
root@226180:/# certbot --nginx
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Enter email address (used for urgent renewal and security notices)
 (Enter 'c' to cancel): bareust@gmail.com

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Please read the Terms of Service at
https://letsencrypt.org/documents/LE-SA-v1.3-September-21-2022.pdf. You must
agree in order to register with the ACME server. Do you agree?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
(Y)es/(N)o: y

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Would you be willing, once your first certificate is successfully issued, to
share your email address with the Electronic Frontier Foundation, a founding
partner of the Let's Encrypt project and the non-profit organization that
develops Certbot? We'd like to send you email about our work encrypting the web,
EFF news, campaigns, and ways to support digital freedom.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
(Y)es/(N)o: y
Account registered.
Please enter the domain name(s) you would like on your certificate (comma and/or
space separated) (Enter 'c' to cancel): stuzhuk.online
Requesting a certificate for stuzhuk.online

Successfully received certificate.
Certificate is saved at: /etc/letsencrypt/live/stuzhuk.online/fullchain.pem
Key is saved at:         /etc/letsencrypt/live/stuzhuk.online/privkey.pem
This certificate expires on 2023-04-25.
These files will be updated when the certificate renews.
Certbot has set up a scheduled task to automatically renew this certificate in the background.

Deploying certificate
Successfully deployed certificate for stuzhuk.online to /etc/nginx/sites-enabled/default
Congratulations! You have successfully enabled HTTPS on https://stuzhuk.online

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
If you like Certbot, please consider supporting our work by:
 * Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
 * Donating to EFF:                    https://eff.org/donate-le
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
root@226180:/# ls
bin   dev  home        initrd.img.old  lib64       media  opt   prod-project  run   snap  swapfile  tmp  var      vmlinuz.old
boot  etc  initrd.img  lib             lost+found  mnt    proc  root          sbin  srv   sys       usr  vmlinuz
root@226180:/# cd prod-project
root@226180:/prod-project# git pull
remote: Enumerating objects: 29, done.
remote: Counting objects: 100% (29/29), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 15 (delta 12), reused 14 (delta 11), pack-reused 0
Unpacking objects: 100% (15/15), done.
From https://github.com/astropsy999/prod-project
   10f849b..0846798  master     -> origin/master
Updating 10f849b..0846798
error: Your local changes to the following files would be overwritten by merge:
	json-server/db.json
Please commit your changes or stash them before you merge.
Aborting
root@226180:/prod-project# git commit -m "Onserver commit"
hint: The '.husky/pre-commit' hook was ignored because it's not set as executable.
hint: You can disable this warning with `git config advice.ignoredHook false`.
On branch master
Your branch is behind 'origin/master' by 1 commit, and can be fast-forwarded.
  (use "git pull" to update your local branch)

Changes not staged for commit:
	modified:   json-server/db.json

no changes added to commit
root@226180:/prod-project# git pull
Updating 10f849b..0846798
error: Your local changes to the following files would be overwritten by merge:
	json-server/db.json
Please commit your changes or stash them before you merge.
Aborting
root@226180:/prod-project# git stash
Saved working directory and index state WIP on master: 10f849b 117 Prettier для форматирования кода. Интегрируем с eslint
root@226180:/prod-project# git pull
Updating 10f849b..0846798
Fast-forward
 .eslintrc.js                             |  4 ++--
 .prettierrc.json                         |  1 +
 8b8798fda0786805698ed4dd4170b113.txt     | 10 +++++-----
 README.md                                |  6 +++---
 config/build/loaders/buildBabelLoader.ts | 62 +++++++++++++++++++++++++++++++-------------------------------
 json-server/db.json                      | 98 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-------------------------
 json-server/index.js                     | 11 +++++++++--
 package.json                             |  4 ++--
 vite.config.ts                           |  1 +
 9 files changed, 127 insertions(+), 70 deletions(-)
root@226180:/prod-project# pm2 list
┌─────┬──────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id  │ name     │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├─────┼──────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0   │ index    │ default     │ 1.0.0   │ fork    │ 13934    │ 64m    │ 16   │ online    │ 0%       │ 56.9mb   │ root     │ disabled │
└─────┴──────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@226180:/prod-project# pm2 stop 0
[PM2] Applying action stopProcessId on app [0](ids: [ '0' ])
[PM2] [index](0) ✓
┌─────┬──────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id  │ name     │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├─────┼──────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0   │ index    │ default     │ 1.0.0   │ fork    │ 0        │ 0      │ 16   │ stopped   │ 0%       │ 0b       │ root     │ disabled │
└─────┴──────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@226180:/prod-project# pm2 start json-server/index.js
[PM2] Applying action restartProcessId on app [index](ids: [ 0 ])
[PM2] [index](0) ✓
[PM2] Process successfully started
┌─────┬──────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id  │ name     │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├─────┼──────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0   │ index    │ default     │ 1.0.0   │ fork    │ 16538    │ 0s     │ 16   │ online    │ 0%       │ 14.4mb   │ root     │ disabled │
└─────┴──────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@226180:/prod-project# pm2 stop 0
[PM2] Applying action stopProcessId on app [0](ids: [ '0' ])
[PM2] [0](0) ✓
┌─────┬──────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id  │ name     │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├─────┼──────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0   │ index    │ default     │ 1.0.0   │ fork    │ 0        │ 0      │ 31   │ stopped   │ 0%       │ 0b       │ root     │ disabled │
└─────┴──────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@226180:/prod-project# git pull
remote: Enumerating objects: 6, done.
remote: Counting objects: 100% (6/6), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 6 (delta 2), reused 6 (delta 2), pack-reused 0
Unpacking objects: 100% (6/6), done.
From https://github.com/astropsy999/prod-project
   0846798..883d969  master     -> origin/master
Updating 0846798..883d969
Fast-forward
 json-server/cert.pem | 21 +++++++++++++++++++++
 json-server/index.js |  6 ++++--
 json-server/key.pm   | 27 +++++++++++++++++++++++++++
 3 files changed, 52 insertions(+), 2 deletions(-)
 create mode 100644 json-server/cert.pem
 create mode 100644 json-server/key.pm
root@226180:/prod-project# pm2 start json-server/index.js
[PM2] Applying action restartProcessId on app [index](ids: [ 0 ])
[PM2] [index](0) ✓
[PM2] Process successfully started
┌─────┬──────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id  │ name     │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├─────┼──────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0   │ index    │ default     │ 1.0.0   │ fork    │ 16812    │ 0s     │ 31   │ online    │ 0%       │ 14.4mb   │ root     │ disabled │
└─────┴──────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@226180:/prod-project# npm run build:prod apiUrl=https://31.172.70.194:8443

> production-project@1.0.0 build:prod
> webpack  --env mode=production "apiUrl=https://31.172.70.194:8443"

13% building 0/1 entries 881/921 dependencies 283/400 modulesRpcExitError: Process 16866 exited [SIGKILL]
Issues checking service aborted - probably out of memory. Check the `memoryLimit` option in the ForkTsCheckerWebpackPlugin configuration.
If increasing the memory doesn't solve the issue, it's most probably a bug in the TypeScript.
assets by info 588 KiB [immutable]
  assets by path *.js 571 KiB
    assets by chunk 86.5 KiB (id hint: vendors) 2 assets
    + 12 assets
  assets by path css/*.css 16.3 KiB
    asset css/main.fa1542e0.css 9.51 KiB [emitted] [immutable] (name: main)
    + 7 assets
assets by path locales/ 1.6 KiB
  assets by path locales/ru/*.json 855 bytes
    asset locales/ru/translation.json 742 bytes [emitted] [from: public/locales/ru/translation.json] [copied]
    + 3 assets
  assets by path locales/en/*.json 779 bytes
    asset locales/en/translation.json 679 bytes [emitted] [from: public/locales/en/translation.json] [copied]
    + 3 assets
asset index.html 419 bytes [emitted]
Entrypoint main [big] 449 KiB = css/main.fa1542e0.css 9.51 KiB main.c368e9b0defffedf1248.js 440 KiB
orphan modules 647 KiB (javascript) 47.7 KiB (runtime) [orphan] 628 modules
runtime modules 10.6 KiB 14 modules
cacheable modules 1.27 MiB (javascript) 12.8 KiB (css/mini-extract)
  javascript modules 1.27 MiB
    modules by path ./node_modules/ 808 KiB 78 modules
    modules by path ./src/ 496 KiB 47 modules
  css modules 12.8 KiB
    modules by path ./src/shared/ 6.75 KiB 21 modules
    modules by path ./src/entities/ 1.73 KiB 10 modules
    modules by path ./src/widgets/ 1.57 KiB 6 modules
    modules by path ./src/features/ 375 bytes 6 modules
    modules by path ./src/pages/ 401 bytes 5 modules
    css ./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[4].use[1]!./node_modules/sass-loader/dist/cjs.js!./src/app/styles/index.scss 2.04 KiB [built] [code generated]

WARNING in asset size limit: The following asset(s) exceed the recommended size limit (244 KiB).
This can impact web performance.
Assets:
  main.c368e9b0defffedf1248.js (440 KiB)

WARNING in entrypoint size limit: The following entrypoint(s) combined asset size exceeds the recommended limit (244 KiB). This can impact web performance.
Entrypoints:
  main (449 KiB)
      css/main.fa1542e0.css
      main.c368e9b0defffedf1248.js


webpack 5.74.0 compiled with 2 warnings in 187050 ms
root@226180:/prod-project# ls
8b8798fda0786805698ed4dd4170b113.txt  config             docs                   netlify.toml       public   tsconfig.json
README.md                             cypress            extractedTranslations  node_modules       reports  vite.config.ts
babel.config.json                     cypress.config.ts  index.html             package-lock.json  scripts  webpack.config.ts
build                                 dist               json-server            package.json       src
root@226180:/prod-project# cd ..
root@226180:/# ls
bin   dev  home        initrd.img.old  lib64       media  opt   prod-project  run   snap  swapfile  tmp  var      vmlinuz.old
boot  etc  initrd.img  lib             lost+found  mnt    proc  root          sbin  srv   sys       usr  vmlinuz
root@226180:/# cd var/www/prod-project
root@226180:/var/www/prod-project# ls
html
root@226180:/var/www/prod-project# cd ../../..
root@226180:/# ls
bin   dev  home        initrd.img.old  lib64       media  opt   prod-project  run   snap  swapfile  tmp  var      vmlinuz.old
boot  etc  initrd.img  lib             lost+found  mnt    proc  root          sbin  srv   sys       usr  vmlinuz
root@226180:/# rm -rf var/www/prod-project/html/
root@226180:/# mv ~/prod-project/build/ /var/www/prod-project/html
mv: cannot stat '/root/prod-project/build/': No such file or directory
root@226180:/# mv /prod-project/build/ /var/www/prod-project/html
root@226180:/# cd var/www/prod-project
root@226180:/var/www/prod-project# ls
html
root@226180:/var/www/prod-project# cd html
root@226180:/var/www/prod-project/html# ls
171.458337c041d7f15460dd.js  555.e7c86e0946be9a594db3.js  638.f56a37a7ad3da952bc23.js  locales
177.f9dd28e54d6108d7e426.js  558.0662caa9f2f454ffe994.js  737.feedb4c02a1f29d00e5d.js  main.c368e9b0defffedf1248.js
218.b64fede4fb566e39cce3.js  571.d420a530c1fec597aa71.js  798.548e4d9a1352ab5fce76.js  main.c368e9b0defffedf1248.js.LICENSE.txt
360.01ed9ac6af219ed06f27.js  59.319c0de6089a04268696.js   css
472.47ec935c895bd6174cb0.js  620.73e37d3b653d14cb6329.js  index.html
root@226180:/var/www/prod-project/html# pm2
usage: pm2 [options] <command>

pm2 -h, --help             all available commands and options
pm2 examples               display pm2 usage examples
pm2 <command> -h           help on a specific command

Access pm2 files in ~/.pm2
root@226180:/var/www/prod-project/html# pm2 list
┌─────┬──────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id  │ name     │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├─────┼──────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0   │ index    │ default     │ 1.0.0   │ fork    │ 16812    │ 41m    │ 31   │ online    │ 0%       │ 40.2mb   │ root     │ disabled │
└─────┴──────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@226180:/var/www/prod-project/html# pm2 stop 0
[PM2] Applying action stopProcessId on app [0](ids: [ '0' ])
[PM2] [index](0) ✓
┌─────┬──────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id  │ name     │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├─────┼──────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0   │ index    │ default     │ 1.0.0   │ fork    │ 0        │ 0      │ 31   │ stopped   │ 0%       │ 0b       │ root     │ disabled │
└─────┴──────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@226180:/var/www/prod-project/html# pm2 start json-server/index.js
[PM2][ERROR] Script not found: /var/www/prod-project/html/json-server/index.js
root@226180:/var/www/prod-project/html# cd ../../
root@226180:/var/www# ../
-bash: ../: Is a directory
root@226180:/var/www# cd ..
root@226180:/var# cd ..
root@226180:/# ls
bin   dev  home        initrd.img.old  lib64       media  opt   prod-project  run   snap  swapfile  tmp  var      vmlinuz.old
boot  etc  initrd.img  lib             lost+found  mnt    proc  root          sbin  srv   sys       usr  vmlinuz
root@226180:/# pm2 start json-server/index.js
[PM2][ERROR] Script not found: /json-server/index.js
root@226180:/# cd prod-project
root@226180:/prod-project# pm2 start json-server/index.js
[PM2] Applying action restartProcessId on app [index](ids: [ 0 ])
[PM2] [index](0) ✓
[PM2] Process successfully started
┌─────┬──────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id  │ name     │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├─────┼──────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0   │ index    │ default     │ 1.0.0   │ fork    │ 17297    │ 0s     │ 31   │ online    │ 0%       │ 14.2mb   │ root     │ disabled │
└─────┴──────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@226180:/prod-project# cd json-server
root@226180:/prod-project/json-server# ls
cert.pem  db.json  index.js  key.pm
root@226180:/prod-project/json-server# vim index.js
root@226180:/prod-project/json-server# cd ../..
root@226180:/# cd etc/nginx/sites-enabled
root@226180:/etc/nginx/sites-enabled# vim default
root@226180:/etc/nginx/sites-enabled# cat default

server {
	listen 80 default_server;
	listen [::]:80;
        root /var/www/prod-project/html;

	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;



	# Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;

	server_name _;

	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		try_files $uri $uri/ /index.html;
	}

	# pass PHP scripts to FastCGI server
	#
	#location ~ \.php$ {
	#	include snippets/fastcgi-php.conf;
	#
	#	# With php-fpm (or other unix sockets):
	#	fastcgi_pass unix:/var/run/php/php7.0-fpm.sock;
	#	# With php-cgi (or other tcp sockets):
	#	fastcgi_pass 127.0.0.1:9000;
	#}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	#location ~ /\.ht {
	#	deny all;
	#}
}


# Virtual Host configuration for example.com
#
# You can move that to a different file under sites-available/ and symlink that
# to sites-enabled/ to enable it.
#
#server {
#	listen 80;
#	listen [::]:80;
#
#	server_name example.com;
#
#	root /var/www/example.com;
#	index index.html;
#
#	location / {
#		try_files $uri $uri/ =404;
#	}
#}

server {
        root /var/www/prod-project/html;

	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;



	# Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;
    server_name stuzhuk.online; # managed by Certbot


	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		try_files $uri $uri/ /index.html;
	}

	# pass PHP scripts to FastCGI server
	#
	#location ~ \.php$ {
	#	include snippets/fastcgi-php.conf;
	#
	#	# With php-fpm (or other unix sockets):
	#	fastcgi_pass unix:/var/run/php/php7.0-fpm.sock;
	#	# With php-cgi (or other tcp sockets):
	#	fastcgi_pass 127.0.0.1:9000;
	#}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	#location ~ /\.ht {
	#	deny all;
	#}


    listen [::]:443 ssl ipv6only=on; # managed by Certbot
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/stuzhuk.online/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/stuzhuk.online/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

}
server {
    if ($host = stuzhuk.online) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


	listen 80 ;
	listen [::]:80;
    server_name stuzhuk.online;
    return 404; # managed by Certbot


}
root@226180:/etc/nginx/sites-enabled# vim default
root@226180:/etc/nginx/sites-enabled# nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
root@226180:/etc/nginx/sites-enabled# service nginx restart
root@226180:/etc/nginx/sites-enabled# cd ../../..
root@226180:/# ls
bin   dev  home        initrd.img.old  lib64       media  opt   prod-project  run   snap  swapfile  tmp  var      vmlinuz.old
boot  etc  initrd.img  lib             lost+found  mnt    proc  root          sbin  srv   sys       usr  vmlinuz
root@226180:/# cd prod-project
root@226180:/prod-project# npm run build:prod apiUrl=https://stuzhuk.online/api

> production-project@1.0.0 build:prod
> webpack  --env mode=production "apiUrl=https://stuzhuk.online/api"

13% building 0/1 entries 921/927 dependencies 300/415 modulesRpcExitError: Process 18477 exited [SIGKILL]
Issues checking service aborted - probably out of memory. Check the `memoryLimit` option in the ForkTsCheckerWebpackPlugin configuration.
If increasing the memory doesn't solve the issue, it's most probably a bug in the TypeScript.
assets by info 588 KiB [immutable]
  assets by path *.js 571 KiB
    assets by chunk 86.5 KiB (id hint: vendors) 2 assets
    + 12 assets
  assets by path css/*.css 16.3 KiB
    asset css/main.fa1542e0.css 9.51 KiB [emitted] [immutable] (name: main)
    + 7 assets
assets by path locales/ 1.6 KiB
  assets by path locales/ru/*.json 855 bytes
    asset locales/ru/translation.json 742 bytes [emitted] [from: public/locales/ru/translation.json] [copied]
    + 3 assets
  assets by path locales/en/*.json 779 bytes
    asset locales/en/translation.json 679 bytes [emitted] [from: public/locales/en/translation.json] [copied]
    + 3 assets
asset index.html 419 bytes [emitted]
Entrypoint main [big] 449 KiB = css/main.fa1542e0.css 9.51 KiB main.63f841431c5aa5cac5e3.js 440 KiB
orphan modules 647 KiB (javascript) 47.7 KiB (runtime) [orphan] 628 modules
runtime modules 10.6 KiB 14 modules
cacheable modules 1.27 MiB (javascript) 12.8 KiB (css/mini-extract)
  javascript modules 1.27 MiB
    modules by path ./node_modules/ 808 KiB 78 modules
    modules by path ./src/ 496 KiB 47 modules
  css modules 12.8 KiB
    modules by path ./src/shared/ 6.75 KiB 21 modules
    modules by path ./src/entities/ 1.73 KiB 10 modules
    modules by path ./src/widgets/ 1.57 KiB 6 modules
    modules by path ./src/features/ 375 bytes 6 modules
    modules by path ./src/pages/ 401 bytes 5 modules
    css ./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[4].use[1]!./node_modules/sass-loader/dist/cjs.js!./src/app/styles/index.scss 2.04 KiB [built] [code generated]

WARNING in asset size limit: The following asset(s) exceed the recommended size limit (244 KiB).
This can impact web performance.
Assets:
  main.63f841431c5aa5cac5e3.js (440 KiB)

WARNING in entrypoint size limit: The following entrypoint(s) combined asset size exceeds the recommended limit (244 KiB). This can impact web performance.
Entrypoints:
  main (449 KiB)
      css/main.fa1542e0.css
      main.63f841431c5aa5cac5e3.js


webpack 5.74.0 compiled with 2 warnings in 115887 ms
root@226180:/prod-project# ls
8b8798fda0786805698ed4dd4170b113.txt  config             docs                   netlify.toml       public   tsconfig.json
README.md                             cypress            extractedTranslations  node_modules       reports  vite.config.ts
babel.config.json                     cypress.config.ts  index.html             package-lock.json  scripts  webpack.config.ts
build                                 dist               json-server            package.json       src
root@226180:/prod-project# cd ..
root@226180:/# ls
bin   dev  home        initrd.img.old  lib64       media  opt   prod-project  run   snap  swapfile  tmp  var      vmlinuz.old
boot  etc  initrd.img  lib             lost+found  mnt    proc  root          sbin  srv   sys       usr  vmlinuz
root@226180:/# rm -rf var/www/prod-project/html
root@226180:/# mv prod-project/build var/www/prod-project/html
root@226180:/# cd etc/nginx/sites-enabled/vim default
-bash: cd: too many arguments
root@226180:/# cd etc/nginx
root@226180:/etc/nginx# cd sites-enabled/
root@226180:/etc/nginx/sites-enabled# vim default

                # as directory, then fall back to displaying a 404.
                try_files $uri $uri/ /index.html;
        }

        # pass PHP scripts to FastCGI server
        #
        #location ~ \.php$ {
        #       include snippets/fastcgi-php.conf;
        #
        #       # With php-fpm (or other unix sockets):
        #       fastcgi_pass unix:/var/run/php/php7.0-fpm.sock;
        #       # With php-cgi (or other tcp sockets):
        #       fastcgi_pass 127.0.0.1:9000;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #       deny all;
        #}

    listen [::]:443 ssl ipv6only=on; # managed by Certbot
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/stuzhuk.online/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/stuzhuk.online/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}
server {
    if ($host = stuzhuk.online) {
        return 301 https://$host$request_uri;
    } # managed by Certbot
        listen 80 ;
        listen [::]:80;
    server_name stuzhuk.online;
    return 404; # managed by Certbot
}
